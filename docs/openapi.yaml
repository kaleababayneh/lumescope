openapi: 3.0.3
info:
  title: LumeScope API
  version: v1
  description: |
    LumeScope API provides access to Lumera blockchain action data, supernode metrics, 
    and version compatibility information. This API enables monitoring and analysis of 
    the Lumera network's distributed storage operations.

servers:
  - url: /
    description: Current server

paths:
  /healthz:
    get:
      summary: Health check endpoint
      description: Liveness probe that indicates if the process is alive and able to serve HTTP requests
      operationId: getHealthz
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            text/plain:
              schema:
                type: string
                example: ok

  /readyz:
    get:
      summary: Readiness check endpoint
      description: Readiness probe that indicates if the service is ready to accept traffic
      operationId: getReadyz
      tags:
        - Health
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ready

  /v1/actions:
    get:
      summary: List actions
      description: Retrieve a paginated list of blockchain actions with optional filtering
      operationId: listActions
      tags:
        - Actions
      parameters:
        - name: type
          in: query
          description: Filter by action type
          schema:
            type: string
            enum:
              - ACTION_TYPE_UNSPECIFIED
              - ACTION_TYPE_CASCADE
              - ACTION_TYPE_SENSE
        - name: creator
          in: query
          description: Filter by creator address
          schema:
            type: string
        - name: state
          in: query
          description: Filter by action state
          schema:
            type: string
            enum:
              - ACTION_STATE_UNSPECIFIED
              - ACTION_STATE_PENDING
              - ACTION_STATE_DONE
              - ACTION_STATE_APPROVED
              - ACTION_STATE_EXPIRED
        - name: supernode
          in: query
          description: Filter actions where the superNodes array contains the provided supernode account address
          schema:
            type: string
        - name: from
          in: query
          description: Filter actions from block height
          schema:
            type: integer
            format: int64
        - name: to
          in: query
          description: Filter actions to block height
          schema:
            type: integer
            format: int64
        - name: limit
          in: query
          description: Maximum number of items to return (1-200)
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - name: cursor
          in: query
          description: Pagination cursor for next page
          schema:
            type: string
        - name: include_transactions
          in: query
          description: Include transaction details (register, finalize, approve) in the response. Default is false.
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionsListResponse'

  /v1/actions/{id}:
    get:
      summary: Get action details
      description: Retrieve detailed information about a specific action by ID
      operationId: getAction
      tags:
        - Actions
      parameters:
        - name: id
          in: path
          required: true
          description: Action ID
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionDetail'
        '404':
          description: Action not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/actions/stats:
    get:
      summary: Get global action statistics
      description: |
        Retrieve aggregated action statistics for all actions (global).
        Returns total count, a breakdown by state (PENDING, DONE, APPROVED, EXPIRED),
        and MIME type statistics with count and average file size.
        Supports optional time filtering via `from` and `to` parameters.
      operationId: getActionStats
      tags:
        - Actions
      parameters:
        - name: type
          in: query
          description: Filter by action type
          schema:
            type: string
            enum:
              - ACTION_TYPE_UNSPECIFIED
              - ACTION_TYPE_CASCADE
              - ACTION_TYPE_SENSE
        - name: from
          in: query
          description: Filter actions created at or after this timestamp (RFC3339 format)
          schema:
            type: string
            format: date-time
          example: "2024-01-01T00:00:00Z"
        - name: to
          in: query
          description: Filter actions created at or before this timestamp (RFC3339 format)
          schema:
            type: string
            format: date-time
          example: "2024-12-31T23:59:59Z"
      responses:
        '200':
          description: Successful response with action statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionStatsResponse'
        '400':
          description: Invalid query parameter (e.g., invalid date format)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/supernodes/metrics:
    get:
      summary: Get supernode metrics
      description: Retrieve current metrics for all supernodes including availability, RTT, and queue depth
      operationId: getSupernodeMetrics
      tags:
        - Supernodes
      parameters:
        - name: currentState
          in: query
          description: |
            Filter by the on-chain state of supernodes. Uses exact enum values from the Lumera chain.
          schema:
            type: string
            enum:
              - SUPERNODE_STATE_UNSPECIFIED
              - SUPERNODE_STATE_ACTIVE
              - SUPERNODE_STATE_DISABLED
              - SUPERNODE_STATE_STOPPED
              - SUPERNODE_STATE_PENALIZED
        - name: status
          in: query
          description: |
            Filter by availability status. When 'available', returns only supernodes where all 3 ports are open:
            - Status API (port 8002)
            - Port1 (from ipAddress)
            - P2P port (4445)
            When 'unavailable', returns supernodes where at least one port is not open.
          schema:
            type: string
            enum:
              - available
              - unavailable
              - any
            default: any
        - name: version
          in: query
          description: Filter by supernode version
          schema:
            type: string
        - name: minFailedProbeCounter
          in: query
          description: Minimum failed probe counter value
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          description: Maximum number of items to return (1-200)
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 100
        - name: cursor
          in: query
          description: Pagination cursor for next page (base64 encoded JSON with account)
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupernodeMetricsResponse'
        '400':
          description: Invalid query parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/supernodes/unavailable:
    get:
      summary: List unavailable supernodes
      description: Retrieve supernodes where status API is unavailable (isStatusApiAvailable=false), with optional state filtering
      operationId: listUnavailableSupernodes
      tags:
        - Supernodes
      parameters:
        - name: currentState
          in: query
          description: Filter by current state of supernodes
          schema:
            type: string
            enum:
              - running
              - stopped
              - any
            default: running
      responses:
        '200':
          description: Successful response with list of unavailable supernodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SupernodeDetail'
        '400':
          description: Invalid query parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/supernodes/{id}/metrics:
    get:
      summary: Get metrics for a specific supernode
      description: Retrieve detailed metrics and status information for a specific supernode by its account ID
      operationId: getSingleSupernodeMetrics
      tags:
        - Supernodes
      parameters:
        - name: id
          in: path
          required: true
          description: Supernode account ID
          schema:
            type: string
      responses:
        '200':
          description: Successful response with supernode metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SingleSupernodeMetrics'
        '400':
          description: Invalid supernode ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Supernode not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/supernodes/stats:
    get:
      summary: Get aggregated supernode hardware statistics
      description: |
        Retrieve aggregated hardware statistics for fully available supernodes.
        A supernode is considered "fully available" when all three ports are open:
        - Status API (port 8002)
        - Port1 (from ipAddress)
        - P2P port (4445)
      operationId: getSupernodeStats
      tags:
        - Supernodes
      responses:
        '200':
          description: Successful response with aggregated hardware stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupernodeStatsResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/supernodes/action-stats:
    get:
      summary: Get action statistics for a supernode
      description: |
        Retrieve aggregated action statistics for a specific supernode address.
        Returns counts grouped by action state for all actions where the supernode
        is listed in the superNodes array.
      operationId: getSupernodeActionStats
      tags:
        - Supernodes
      parameters:
        - name: address
          in: query
          required: true
          description: The supernode address to filter actions by
          schema:
            type: string
            example: lumera1563uuzljqvpanh79w2tvymqsly73v9nwygda73
        - name: type
          in: query
          description: Filter by action type
          schema:
            type: string
            enum:
              - ACTION_TYPE_UNSPECIFIED
              - ACTION_TYPE_CASCADE
              - ACTION_TYPE_SENSE
      responses:
        '200':
          description: Successful response with action statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupernodeActionStatsResponse'
        '400':
          description: Invalid or missing address parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/version/matrix:
    get:
      summary: Get version compatibility matrix
      description: Retrieve information about chain action versions, supernode capabilities, and compatibility
      operationId: getVersionMatrix
      tags:
        - Version
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionMatrixResponse'

components:
  schemas:
    ActionStatsResponse:
      type: object
      description: Aggregated action statistics for all actions (global)
      properties:
        total:
          type: integer
          description: Total number of actions
          example: 100
        states:
          type: object
          description: Count of actions grouped by state
          additionalProperties:
            type: integer
          example:
            ACTION_STATE_PENDING: 10
            ACTION_STATE_DONE: 80
            ACTION_STATE_APPROVED: 5
            ACTION_STATE_EXPIRED: 5
        mime_types:
          type: array
          description: Statistics for each MIME type (count and average file size)
          items:
            $ref: '#/components/schemas/MimeTypeStat'
        schema_version:
          type: string
          description: API schema version
          example: v1.0
      required:
        - total
        - states
        - schema_version

    MimeTypeStat:
      type: object
      description: Statistics for a specific MIME type
      properties:
        type:
          type: string
          description: The MIME type
          example: image/jpeg
        count:
          type: integer
          description: Number of actions with this MIME type
          example: 50
        avg_size:
          type: number
          format: double
          description: Average file size in bytes for actions with this MIME type
          example: 1024.5
      required:
        - type
        - count
        - avg_size

    SupernodeActionStatsResponse:
      type: object
      description: Aggregated action statistics for a specific supernode
      properties:
        total:
          type: integer
          description: Total number of actions associated with the supernode
          example: 10
        states:
          type: object
          description: Count of actions grouped by state
          additionalProperties:
            type: integer
          example:
            ACTION_STATE_PENDING: 2
            ACTION_STATE_DONE: 8
        supernode_address:
          type: string
          description: The supernode address used for filtering
          example: lumera1563uuzljqvpanh79w2tvymqsly73v9nwygda73
        schema_version:
          type: string
          description: API schema version
          example: v1.0
      required:
        - total
        - states
        - supernode_address
        - schema_version

    SupernodeStatsResponse:
      type: object
      description: Aggregated hardware statistics for fully available supernodes
      properties:
        total_cpu_cores:
          type: integer
          format: int64
          description: Sum of CPU cores across all fully available supernodes
          example: 256
        total_memory_gb:
          type: number
          format: double
          description: Sum of total memory (GB) across all fully available supernodes
          example: 1024.5
        total_storage_bytes:
          type: integer
          format: int64
          description: Sum of total storage (bytes) across all fully available supernodes
          example: 10995116277760
        used_storage_bytes:
          type: integer
          format: int64
          description: Sum of used storage (bytes) across all fully available supernodes
          example: 5497558138880
        available_storage_bytes:
          type: integer
          format: int64
          description: Calculated available storage (total - used) in bytes
          example: 5497558138880
        storage_used_percent:
          type: number
          format: double
          description: Percentage of storage used (used / total * 100)
          example: 50.0
        storage_available_percent:
          type: number
          format: double
          description: Percentage of storage available (available / total * 100)
          example: 50.0
        available_supernodes:
          type: integer
          format: int64
          description: Number of fully available supernodes included in the statistics
          example: 42
        schema_version:
          type: string
          description: API schema version
          example: v1.0

    ActionsListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ActionItem'
        next_cursor:
          type: string
          description: Cursor for fetching the next page
        schema_version:
          type: string
          example: v1.0

    ActionItem:
      type: object
      properties:
        id:
          type: string
          description: Unique action identifier
          example: act_1
        type:
          type: string
          description: Action type (e.g., cascade, transfer)
          example: cascade
        creator:
          type: string
          description: Creator address
          example: lumera1example...
        state:
          type: string
          description: Current action state
          example: committed
        block_height:
          type: integer
          format: int64
          description: Block height when action was created
          example: 12345
        mime_type:
          type: string
          description: MIME type of the action's file (e.g., image/jpeg, text/plain, application/pdf). Returns application/octet-stream for unknown types.
          example: image/jpeg
        size:
          type: integer
          format: int64
          description: File size in bytes
          example: 1048576
        price:
          $ref: '#/components/schemas/Price'
        decoded:
          type: object
          additionalProperties: true
          description: Decoded action data
        raw:
          type: string
          description: Base64 encoded raw bytes for unknown types
        superNodes:
          type: array
          description: List of SuperNode operator addresses associated with the action
          items:
            type: string
            example: lumera1563uuzljqvpanh79w2tvymqsly73v9nwygda73
        transactions:
          type: array
          description: Transaction lifecycle data (register, finalize, approve)
          items:
            $ref: '#/components/schemas/Transaction'
        register_tx_id:
          type: string
          nullable: true
          description: Transaction hash for the register transaction
          example: "A1B2C3D4E5F6..."
        register_tx_time:
          type: string
          format: date-time
          nullable: true
          description: Block timestamp for the register transaction
        finalize_tx_id:
          type: string
          nullable: true
          description: Transaction hash for the finalize transaction
          example: "B2C3D4E5F6G7..."
        finalize_tx_time:
          type: string
          format: date-time
          nullable: true
          description: Block timestamp for the finalize transaction
        approve_tx_id:
          type: string
          nullable: true
          description: Transaction hash for the approve transaction
          example: "C3D4E5F6G7H8..."
        approve_tx_time:
          type: string
          format: date-time
          nullable: true
          description: Block timestamp for the approve transaction

    ActionDetail:
      type: object
      properties:
        id:
          type: string
          description: Unique action identifier
        type:
          type: string
          description: Action type
          example: cascade
        creator:
          type: string
          description: Creator address
        state:
          type: string
          description: Current action state
          example: committed
        block_height:
          type: integer
          format: int64
          description: Block height when action was created
          example: 12345
        mime_type:
          type: string
          description: MIME type of the action's file (e.g., image/jpeg, text/plain, application/pdf). Returns application/octet-stream for unknown types.
          example: image/jpeg
        size:
          type: integer
          format: int64
          description: File size in bytes
          example: 1048576
        price:
          $ref: '#/components/schemas/Price'
        timestamp:
          type: string
          format: date-time
          description: Action timestamp
        decoded:
          type: object
          additionalProperties: true
          description: Decoded action data
        raw:
          type: string
          description: Base64 encoded raw bytes for unknown types
        super_nodes:
          type: object
          additionalProperties: true
          description: SuperNode data associated with the action
        transactions:
          type: array
          description: Transaction lifecycle data (register, finalize, approve)
          items:
            $ref: '#/components/schemas/Transaction'
        register_tx_id:
          type: string
          nullable: true
          description: Transaction hash for the register transaction
          example: "A1B2C3D4E5F6..."
        register_tx_time:
          type: string
          format: date-time
          nullable: true
          description: Block timestamp for the register transaction
        finalize_tx_id:
          type: string
          nullable: true
          description: Transaction hash for the finalize transaction
          example: "B2C3D4E5F6G7..."
        finalize_tx_time:
          type: string
          format: date-time
          nullable: true
          description: Block timestamp for the finalize transaction
        approve_tx_id:
          type: string
          nullable: true
          description: Transaction hash for the approve transaction
          example: "C3D4E5F6G7H8..."
        approve_tx_time:
          type: string
          format: date-time
          nullable: true
          description: Block timestamp for the approve transaction
        schema_version:
          type: string
          example: v1.0

    Price:
      type: object
      description: Price information for an action
      properties:
        denom:
          type: string
          description: Price denomination
          example: ulume
        amount:
          type: string
          description: Price amount as string
          example: "1000000"

    Transaction:
      type: object
      description: Transaction data associated with an action's lifecycle
      properties:
        tx_type:
          type: string
          description: Type of transaction (register, finalize, approve)
          enum:
            - register
            - finalize
            - approve
          example: register
        tx_hash:
          type: string
          description: Transaction hash
          example: "A1B2C3D4E5F6..."
        height:
          type: integer
          format: int64
          description: Block height of the transaction
          example: 12345
        block_time:
          type: string
          format: date-time
          description: Block timestamp
        gas_wanted:
          type: integer
          format: int64
          description: Gas requested for the transaction
          example: 200000
        gas_used:
          type: integer
          format: int64
          description: Gas actually used by the transaction
          example: 150000
        action_price:
          type: string
          description: Action price amount (for finalize/approve transactions)
          example: "1000000"
        action_price_denom:
          type: string
          description: Action price denomination
          example: ulume
        tx_fee:
          type: string
          description: Transaction fee amount
          example: "5000"
        tx_fee_denom:
          type: string
          description: Transaction fee denomination
          example: ulume
        flow_payer:
          type: string
          description: Address of the payer in the flow
        flow_payee:
          type: string
          description: Address of the payee in the flow
      required:
        - tx_type
        - tx_hash
        - height
        - block_time

    CascadeLEP1:
      type: object
      description: Cascade layout information for LEP1
      properties:
        root_cid:
          type: string
          description: Root CID of the cascade
          example: bafy...
        piece_count:
          type: integer
          description: Number of pieces in the cascade
          example: 12
        total_size_bytes:
          type: integer
          format: int64
          description: Total size in bytes
          example: 1048576
        preview_mime:
          type: string
          description: MIME type for preview
          example: image/png

    SupernodeMetricsResponse:
      type: object
      properties:
        total:
          type: integer
          description: Total number of supernodes returned in this response
          example: 42
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/SingleSupernodeMetrics'
        next_cursor:
          type: string
          description: Pagination cursor for next page (base64 encoded)
        schema_version:
          type: string
          example: v1.0

    SupernodeMetric:
      type: object
      properties:
        node_id:
          type: string
          description: Supernode identifier
          example: sn-1
        address:
          type: string
          description: Supernode address URL
          example: https://sn1.example.com
        last_scrape:
          type: string
          format: date-time
          description: Last time metrics were scraped
        availability:
          type: number
          format: float
          description: Availability percentage (0.0-1.0)
          example: 1.0
        rtt_ms:
          type: integer
          description: Round-trip time in milliseconds
          example: 120
        queue_depth:
          type: integer
          description: Current queue depth
          example: 2
        last_status:
          type: string
          description: Last status check result
          example: ok

    MetricsRollup:
      type: object
      properties:
        sampled_at:
          type: string
          format: date-time
          description: When metrics were sampled
        node_count:
          type: integer
          description: Total number of nodes
          example: 2
        available_pct:
          type: number
          format: float
          description: Overall availability percentage
          example: 99.0
        avg_rtt_ms:
          type: integer
          description: Average RTT across all nodes
          example: 140

    VersionMatrixResponse:
      type: object
      description: Version compatibility matrix showing distribution of supernode versions
      properties:
        latest_version:
          type: string
          description: The most common version across the network (heuristic for latest)
          example: v2.3.0
        versions:
          type: array
          description: List of versions and their statistics
          items:
            $ref: '#/components/schemas/VersionMatrixRow'
      required:
        - versions

    VersionMatrixRow:
      type: object
      description: Statistics for a specific version
      properties:
        version:
          type: string
          description: Software version string
          example: v2.3.0
        nodes_total:
          type: integer
          description: Total number of supernodes running this version
          example: 42
        nodes_available:
          type: integer
          description: Number of supernodes with status API available
          example: 40
        nodes_unavailable:
          type: integer
          description: Number of supernodes with status API unavailable
          example: 2
        is_latest:
          type: boolean
          description: Whether this is the most common (latest) version
          example: true
      required:
        - version
        - nodes_total
        - nodes_available
        - nodes_unavailable
        - is_latest

    Error:
      type: object
      description: Error response
      properties:
        error:
          type: string
          description: Error message
          example: internal_error
      required:
        - error

    SupernodeDetail:
      type: object
      properties:
        supernodeAccount:
          type: string
          description: Supernode account address
        validatorAddress:
          type: string
          description: Validator address
        validatorMoniker:
          type: string
          description: Validator moniker/name
        currentState:
          type: string
          description: Current state of the supernode
        ipAddress:
          type: string
          description: IP address of the supernode
        p2pPort:
          type: integer
          description: P2P port number
        protocolVersion:
          type: string
          description: Protocol version
        isStatusApiAvailable:
          type: boolean
          description: Whether the status API is available

    SingleSupernodeMetrics:
      type: object
      description: Detailed metrics and status information for a specific supernode
      properties:
        supernode_account:
          type: string
          description: Supernode account address
        validator_address:
          type: string
          description: Validator address
        validator_moniker:
          type: string
          description: Validator moniker/name
        current_state:
          type: string
          description: Current state of the supernode
          example: SUPERNODE_STATE_RUNNING
        ip_address:
          type: string
          description: IP address of the supernode
        p2p_port:
          type: integer
          description: P2P port number
        protocol_version:
          type: string
          description: Protocol version
          example: "1.0.0"
        actual_version:
          type: string
          description: Actual running version of the supernode software
        cpu_usage_percent:
          type: number
          format: double
          description: CPU usage percentage
        cpu_cores:
          type: integer
          description: Number of CPU cores
        memory_total_gb:
          type: number
          format: double
          description: Total memory in GB
        memory_used_gb:
          type: number
          format: double
          description: Used memory in GB
        memory_usage_percent:
          type: number
          format: double
          description: Memory usage percentage
        storage_total_bytes:
          type: integer
          format: int64
          description: Total storage in bytes
        storage_used_bytes:
          type: integer
          format: int64
          description: Used storage in bytes
        storage_usage_percent:
          type: number
          format: double
          description: Storage usage percentage
        hardware_summary:
          type: string
          description: Hardware summary information
        peers_count:
          type: integer
          description: Number of connected peers
        uptime_seconds:
          type: integer
          format: int64
          description: Uptime in seconds
        rank:
          type: integer
          description: Supernode rank
        last_status_check:
          type: string
          format: date-time
          description: Timestamp of last status check
        is_status_api_available:
          type: boolean
          description: Whether the status API is currently available
        metrics_report:
          type: object
          additionalProperties: true
          description: Additional metrics report data
        schema_version:
          type: string
          example: v1.0


tags:
  - name: Health
    description: Health and readiness endpoints
  - name: Actions
    description: Blockchain action operations
  - name: Supernodes
    description: Supernode metrics and monitoring
  - name: Version
    description: Version and compatibility information